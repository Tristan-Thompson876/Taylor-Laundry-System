<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taylor Hall Laundry System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .auth-container {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .link-btn {
            text-align: center;
            margin-top: 20px;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        .dashboard {
            display: none;
        }

        .user-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .machine-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            background: #fafafa;
        }

        .machine-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .time-slot {
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-slot.available {
            background: #d1fae5;
            border: 2px solid #10b981;
        }

        .time-slot.available:hover {
            background: #a7f3d0;
            transform: translateX(5px);
        }

        .time-slot.booked {
            background: #fee2e2;
            border: 2px solid #ef4444;
            cursor: not-allowed;
        }

        .time-slot.my-booking {
            background: #dbeafe;
            border: 2px solid #3b82f6;
        }

        .my-bookings {
            margin-top: 30px;
        }

        .booking-card {
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .booking-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .booking-actions button {
            flex: 1;
            padding: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th, .admin-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .admin-table th {
            background: #667eea;
            color: white;
        }

        .admin-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-expired {
            background: #fee2e2;
            color: #991b1b;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 60px 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-top: 20px;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß∫ Taylor Hall Laundry System</h1>
            <p>Book your laundry time slots with ease</p>
        </div>

        <div class="content">
            <!-- Login Form -->
            <div id="loginForm" class="auth-container">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Login</h2>
                <div class="form-group">
                    <label for="loginEmail">Email or Student ID</label>
                    <input type="text" id="loginEmail" placeholder="Enter your email or ID">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="btn btn-primary" onclick="login()">Login</button>
                <div class="link-btn" onclick="showSignup()">Don't have an account? Sign Up</div>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" class="auth-container hidden">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Sign Up</h2>
                <div class="form-group">
                    <label for="signupName">Full Name</label>
                    <input type="text" id="signupName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="signupStudentId">Student ID</label>
                    <input type="text" id="signupStudentId" placeholder="Enter your student ID">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Create a password">
                </div>
                <button class="btn btn-primary" onclick="signup()">Sign Up</button>
                <div class="link-btn" onclick="showLogin()">Already have an account? Login</div>
            </div>

            <!-- User Dashboard -->
            <div id="userDashboard" class="dashboard">
                <div class="user-info">
                    <div>
                        <h2 id="userName"></h2>
                        <p>Student ID: <strong id="userStudentId"></strong></p>
                    </div>
                    <button class="btn btn-secondary" style="width: auto; padding: 10px 30px;" onclick="logout()">Logout</button>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="showTab('schedule')">Available Machines</button>
                    <button class="tab" onclick="showTab('mybookings')">My Bookings</button>
                </div>

                <div id="scheduleTab">
                    <h2>Select a Time Slot</h2>
                    <div id="scheduleGrid" class="schedule-grid"></div>
                </div>

                <div id="mybookingsTab" class="hidden">
                    <h2>My Bookings</h2>
                    <div id="myBookingsList"></div>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="dashboard">
                <div class="user-info">
                    <div>
                        <h2>Admin Dashboard</h2>
                        <p>Manage all bookings and schedules</p>
                    </div>
                    <button class="btn btn-secondary" style="width: auto; padding: 10px 30px;" onclick="logout()">Logout</button>
                </div>

                <h2>All Bookings</h2>
                <div id="adminBookingsContainer">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Student ID</th>
                                <th>Machine</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminBookingsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <h2>Confirm Booking</h2>
            <p><strong>Machine:</strong> <span id="modalMachine"></span></p>
            <p><strong>Date:</strong> <span id="modalDate"></span></p>
            <p><strong>Time:</strong> <span id="modalTime"></span></p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" style="flex: 1;" onclick="confirmBooking()">Confirm</button>
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Reschedule Modal -->
    <div id="rescheduleModal" class="modal">
        <div class="modal-content">
            <h2>Reschedule Booking</h2>
            <div class="form-group">
                <label for="rescheduleMachine">Select Machine</label>
                <select id="rescheduleMachine"></select>
            </div>
            <div class="form-group">
                <label for="rescheduleDate">Select Date</label>
                <input type="date" id="rescheduleDate">
            </div>
            <div class="form-group">
                <label for="rescheduleTime">Select Time</label>
                <select id="rescheduleTime"></select>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" style="flex: 1;" onclick="confirmReschedule()">Reschedule</button>
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeRescheduleModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize data storage
        let users = JSON.parse(localStorage.getItem('laundryUsers')) || [
            { email: 'admin@taylor.edu', password: 'admin123', role: 'admin', name: 'Admin User', studentId: 'ADMIN001' }
        ];
        
        let bookings = JSON.parse(localStorage.getItem('laundryBookings')) || [];
        let currentUser = null;
        let selectedBooking = null;

        const machines = ['Washer 1', 'Washer 2', 'Washer 3', 'Dryer 1', 'Dryer 2'];
        const timeSlots = [
            '08:00 - 09:00', '09:00 - 10:00', '10:00 - 11:00', '11:00 - 12:00',
            '12:00 - 13:00', '13:00 - 14:00', '14:00 - 15:00', '15:00 - 16:00',
            '16:00 - 17:00', '17:00 - 18:00', '18:00 - 19:00', '19:00 - 20:00'
        ];

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('laundryUsers', JSON.stringify(users));
            localStorage.setItem('laundryBookings', JSON.stringify(bookings));
            console.log('Data saved. Total bookings:', bookings.length);
        }

        // Show/Hide forms
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
        }

        function showSignup() {
            document.getElementById('signupForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
        }

        // Login
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => (u.email === email || u.studentId === email) && u.password === password);

            if (user) {
                currentUser = user;
                document.getElementById('loginForm').classList.add('hidden');
                
                if (user.role === 'admin') {
                    showAdminDashboard();
                } else {
                    showUserDashboard();
                }
            } else {
                alert('Invalid credentials!');
            }
        }

        // Signup
        function signup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const studentId = document.getElementById('signupStudentId').value;
            const password = document.getElementById('signupPassword').value;

            if (!name || !email || !studentId || !password) {
                alert('Please fill in all fields!');
                return;
            }

            if (users.find(u => u.email === email || u.studentId === studentId)) {
                alert('User already exists!');
                return;
            }

            users.push({
                name,
                email,
                studentId,
                password,
                role: 'user'
            });

            saveData();
            alert('Account created successfully! Please login.');
            showLogin();
        }

        // Logout
        function logout() {
            currentUser = null;
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('loginForm').classList.remove('hidden');
        }

        // Show User Dashboard
        function showUserDashboard() {
            document.getElementById('userDashboard').style.display = 'block';
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userStudentId').textContent = currentUser.studentId;
            renderSchedule();
            renderMyBookings();
        }

        // Show Admin Dashboard
        function showAdminDashboard() {
            document.getElementById('adminDashboard').style.display = 'block';
            renderAdminBookings();
        }

        // Tab switching
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'schedule') {
                document.getElementById('scheduleTab').classList.remove('hidden');
                document.getElementById('mybookingsTab').classList.add('hidden');
                renderSchedule();
            } else {
                document.getElementById('scheduleTab').classList.add('hidden');
                document.getElementById('mybookingsTab').classList.remove('hidden');
                renderMyBookings();
            }
        }

        // Get today's date
        function getTodayDate() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        // Render schedule
        function renderSchedule() {
            const grid = document.getElementById('scheduleGrid');
            grid.innerHTML = '';

            const today = getTodayDate();

            machines.forEach(machine => {
                const card = document.createElement('div');
                card.className = 'machine-card';
                card.innerHTML = `<h3>${machine}</h3>`;

                timeSlots.forEach(time => {
                    const booking = bookings.find(b => 
                        b.machine === machine && 
                        b.time === time && 
                        b.date === today
                    );

                    const slot = document.createElement('div');
                    slot.className = 'time-slot';

                    if (booking) {
                        if (booking.userId === currentUser.studentId) {
                            slot.className += ' my-booking';
                            slot.innerHTML = `<span>${time}</span><span>Your Booking</span>`;
                        } else {
                            slot.className += ' booked';
                            slot.innerHTML = `<span>${time}</span><span>Booked</span>`;
                        }
                    } else {
                        slot.className += ' available';
                        slot.innerHTML = `<span>${time}</span><span>Available</span>`;
                        slot.onclick = () => openBookingModal(machine, today, time);
                    }

                    card.appendChild(slot);
                });

                grid.appendChild(card);
            });
        }

        // Open booking modal
        let pendingBooking = null;

        function openBookingModal(machine, date, time) {
            pendingBooking = { machine, date, time };
            document.getElementById('modalMachine').textContent = machine;
            document.getElementById('modalDate').textContent = date;
            document.getElementById('modalTime').textContent = time;
            document.getElementById('bookingModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('bookingModal').style.display = 'none';
            pendingBooking = null;
        }

        // Confirm booking
        function confirmBooking() {
            if (!pendingBooking) return;

            const booking = {
                id: Date.now().toString(),
                userId: currentUser.studentId,
                userName: currentUser.name,
                machine: pendingBooking.machine,
                date: pendingBooking.date,
                time: pendingBooking.time,
                createdAt: new Date().toISOString()
            };

            bookings.push(booking);
            saveData();
            
            console.log('Booking created:', booking);
            console.log('All bookings:', bookings);
            
            closeModal();
            renderSchedule();
            renderMyBookings();
            alert('Booking confirmed! Your Student ID is: ' + currentUser.studentId);
        }

        // Render my bookings
        function renderMyBookings() {
            const container = document.getElementById('myBookingsList');
            const myBookings = bookings.filter(b => b.userId === currentUser.studentId);

            console.log('Rendering my bookings. Total:', myBookings.length);
            console.log('Current user ID:', currentUser.studentId);
            console.log('My bookings:', myBookings);

            if (myBookings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>üìÖ No Bookings Yet</h3>
                        <p>Book a time slot from the "Available Machines" tab to get started!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = myBookings.map(booking => `
                <div class="booking-card">
                    <h3>üß∫ ${booking.machine}</h3>
                    <p><strong>üìÖ Date:</strong> ${booking.date}</p>
                    <p><strong>‚è∞ Time:</strong> ${booking.time}</p>
                    <p><strong>üÜî Your ID:</strong> ${booking.userId}</p>
                    <div class="booking-actions">
                        <button class="btn btn-success" onclick="openRescheduleModal('${booking.id}')">Reschedule</button>
                        <button class="btn btn-danger" onclick="cancelBooking('${booking.id}')">Cancel</button>
                    </div>
                </div>
            `).join('');
        }

        // Cancel booking
        function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking?')) {
                bookings = bookings.filter(b => b.id !== bookingId);
                saveData();
                renderSchedule();
                renderMyBookings();
                alert('Booking cancelled successfully!');
            }
        }

        // Open reschedule modal
        function openRescheduleModal(bookingId) {
            selectedBooking = bookings.find(b => b.id === bookingId);
            
            // Populate machines
            const machineSelect = document.getElementById('rescheduleMachine');
            machineSelect.innerHTML = machines.map(m => 
                `<option value="${m}" ${m === selectedBooking.machine ? 'selected' : ''}>${m}</option>`
            ).join('');

            // Set date
            document.getElementById('rescheduleDate').value = getTodayDate();
            document.getElementById('rescheduleDate').min = getTodayDate();

            // Populate times
            updateRescheduleTimeSlots();

            document.getElementById('rescheduleModal').style.display = 'flex';
        }

        function closeRescheduleModal() {
            document.getElementById('rescheduleModal').style.display = 'none';
            selectedBooking = null;
        }

        function updateRescheduleTimeSlots() {
            const machine = document.getElementById('rescheduleMachine').value;
            const date = document.getElementById('rescheduleDate').value;
            const timeSelect = document.getElementById('rescheduleTime');

            const availableSlots = timeSlots.filter(time => {
                return !bookings.some(b => 
                    b.machine === machine && 
                    b.time === time && 
                    b.date === date &&
                    b.id !== selectedBooking.id
                );
            });

            timeSelect.innerHTML = availableSlots.map(time => 
                `<option value="${time}">${time}</option>`
            ).join('');
        }

        // Event listeners for reschedule modal
        document.getElementById('rescheduleMachine').addEventListener('change', updateRescheduleTimeSlots);
        document.getElementById('rescheduleDate').addEventListener('change', updateRescheduleTimeSlots);

        // Confirm reschedule
        function confirmReschedule() {
            const machine = document.getElementById('rescheduleMachine').value;
            const date = document.getElementById('rescheduleDate').value;
            const time = document.getElementById('rescheduleTime').value;

            const booking = bookings.find(b => b.id === selectedBooking.id);
            booking.machine = machine;
            booking.date = date;
            booking.time = time;

            saveData();
            closeRescheduleModal();
            renderSchedule();
            renderMyBookings();
            alert('Booking rescheduled successfully!');
        }

        // Render admin bookings
        function renderAdminBookings() {
            const tbody = document.getElementById('adminBookingsTable');
            
            console.log('Rendering admin bookings. Total:', bookings.length);
            console.log('All bookings:', bookings);
            
            if (bookings.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <h3>üìã No Bookings Yet</h3>
                                <p>Bookings will appear here once students make reservations</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            // Sort bookings by date and time
            const sortedBookings = [...bookings].sort((a, b) => {
                if (a.date !== b.date) {
                    return a.date.localeCompare(b.date);
                }
                return a.time.localeCompare(b.time);
            });

            tbody.innerHTML = sortedBookings.map(booking => {
                const status = 'Active';
                const statusClass = 'status-active';

                return `
                    <tr>
                        <td>${booking.userName}</td>
                        <td>${booking.userId}</td>
                        <td>${booking.machine}</td>
                        <td>${booking.date}</td>
                        <td>${booking.time}</td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>
                            <button class="btn btn-danger" style="padding: 6px 12px; font-size: 14px; width: auto;" onclick="adminCancelBooking('${booking.id}')">Cancel</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Admin cancel booking
        function adminCancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking?')) {
                bookings = bookings.filter(b => b.id !== bookingId);
                saveData();
                renderAdminBookings();
                alert('Booking cancelled successfully!');
            }
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (currentUser) {
                if (currentUser.role === 'admin') {
                    renderAdminBookings();
                } else {
                    renderSchedule();
                    renderMyBookings();
                }
            }
        }, 30000);

        // Initialize - load saved bookings
        console.log('Initialized. Total bookings:', bookings.length);
    </script>
</body>
</html>